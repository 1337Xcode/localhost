# AUTO-GENERATED BY start.sh
worker_processes 2;
pid /data/data/com.termux/files/home/.tor/nginx.pid;
worker_rlimit_nofile 1024;

events {
    worker_connections 128; # Optimized for 150MB RAM limit
    use epoll;
    multi_accept on;
}

http {
    include /data/data/com.termux/files/usr/etc/nginx/mime.types;
    default_type application/octet-stream;
    
    # Rate Limiting Zones
    limit_req_zone $binary_remote_addr zone=portfolio_limit:10m rate=2r/s;
    limit_conn_zone $binary_remote_addr zone=conn_limit:10m;

    # Performance Tuning
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    keepalive_timeout 10; # Reduced for battery saving
    types_hash_max_size 2048;
    server_tokens off;
    
    # Async I/O
    aio threads;
    
    # Compression (Minimal set)
    gzip on;
    gzip_comp_level 5;
    gzip_min_length 256;
    gzip_proxied any;
    gzip_vary on;
    gzip_types
        text/css
        application/javascript
        image/svg+xml;

    # Caching
    expires 30d;
    add_header Cache-Control "public, immutable";
    
    # Logging (Disabled)
    access_log off;
    error_log stderr warn;
    
    server {
        listen 127.0.0.1:8080 http2; # HTTP/2 enabled
        root /data/data/com.termux/files/home/hidden-portfolio/www;
        index index.html;
        
        # Rate Limiting
        limit_req zone=portfolio_limit burst=5 nodelay;
        limit_conn conn_limit 5;
        
        # Security Headers
        add_header X-Frame-Options "SAMEORIGIN" always;
        add_header X-Content-Type-Options "nosniff" always;
        add_header X-XSS-Protection "1; mode=block" always;
        add_header Content-Security-Policy "default-src 'self'; worker-src 'self'; connect-src 'self' wss:;" always;
        add_header Referrer-Policy "no-referrer-when-downgrade" always;
        
        location / {
            try_files $uri $uri/ =404;
        }
        
        # Health Check
        location /health {
            return 200 "OK\n";
        }
        
        location ~ /\. { deny all; }
    }
}
